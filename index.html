<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Study Live</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase COMPAT SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg,#667eea,#764ba2);
  color:#fff;
}
.container{
  max-width:420px;
  margin:40px auto;
  background:#1f1f2e;
  border-radius:18px;
  padding:25px;
  box-shadow:0 20px 40px rgba(0,0,0,0.4);
}
h1{text-align:center;margin-bottom:5px}
.sub{text-align:center;color:#bbb;font-size:14px;margin-bottom:25px}

.btn{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-size:16px;
  cursor:pointer;
  margin-top:10px;
}
.login{background:#fff;color:#000;font-weight:600}
.start{background:#00e676;color:#000}
.stop{background:#ff5252;color:#fff}
.logout{background:#444;color:#fff}

.card{
  background:#2a2a40;
  padding:18px;
  border-radius:14px;
  margin-top:20px;
  text-align:center;
}

.time{
  font-size:36px;
  font-weight:bold;
  margin-top:10px;
}
.hide{display:none}
</style>
</head>

<body>

<div class="container">
  <h1>üìö Study Live</h1>
  <div class="sub">Show you are studying ‚Äî live</div>

  <button class="btn login" id="loginBtn">Login with Google</button>

  <div id="app" class="hide">
    <div class="card">
      <div>Welcome</div>
      <h2 id="name"></h2>
    </div>

    <div class="card">
      <div>Today's Study Time</div>
      <div class="time" id="time">00:00:00</div>
      <button class="btn start" id="startBtn">‚ñ∂ Start Study</button>
      <button class="btn stop hide" id="stopBtn">‚è∏ Stop Study</button>
    </div>

    <button class="btn logout" id="logoutBtn">Logout</button>
  </div>
</div>

<script>
/* üî• FIREBASE CONFIG (YOURS) */
firebase.initializeApp({
  apiKey: "AIzaSyAUnOQq5DvNnnacfzBLRlKaP5Oh2W7fQ1Y",
  authDomain: "study-live-cdc81.firebaseapp.com",
  projectId: "study-live-cdc81",
  storageBucket: "study-live-cdc81.firebasestorage.app",
  messagingSenderId: "656676120180",
  appId: "1:656676120180:web:7ea85f6e650b132e39d321"
});

const auth = firebase.auth();
const db = firebase.firestore();

/* ELEMENTS */
const loginBtn = document.getElementById("loginBtn");
const appDiv = document.getElementById("app");
const nameEl = document.getElementById("name");
const timeEl = document.getElementById("time");
const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const logoutBtn = document.getElementById("logoutBtn");

let timerInterval;
let startTime = null;
let todaySeconds = 0;

/* LOGIN */
loginBtn.onclick = () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
};

/* LOGOUT */
logoutBtn.onclick = () => auth.signOut();

/* AUTH STATE */
auth.onAuthStateChanged(async user => {
  if(user){
    loginBtn.classList.add("hide");
    appDiv.classList.remove("hide");
    nameEl.innerText = user.displayName;

    const today = new Date().toISOString().slice(0,10);
    const ref = db.collection("study").doc(user.uid + "_" + today);
    const doc = await ref.get();

    if(doc.exists){
      todaySeconds = doc.data().seconds || 0;
      updateTime();
    }
  } else {
    loginBtn.classList.remove("hide");
    appDiv.classList.add("hide");
    stopTimer();
  }
});

/* START STUDY */
startBtn.onclick = () => {
  startTime = Date.now();
  startBtn.classList.add("hide");
  stopBtn.classList.remove("hide");

  timerInterval = setInterval(() => {
    const diff = Math.floor((Date.now() - startTime)/1000);
    updateTime(todaySeconds + diff);
  },1000);
};

/* STOP STUDY */
stopBtn.onclick = async () => {
  stopTimer();
  const user = auth.currentUser;
  if(!user) return;

  const today = new Date().toISOString().slice(0,10);
  const ref = db.collection("study").doc(user.uid + "_" + today);

  todaySeconds += Math.floor((Date.now() - startTime)/1000);
  await ref.set({
    uid:user.uid,
    name:user.displayName,
    date:today,
    seconds:todaySeconds,
    updated:firebase.firestore.FieldValue.serverTimestamp()
  });

  updateTime();
};

/* HELPERS */
function stopTimer(){
  clearInterval(timerInterval);
  startBtn.classList.remove("hide");
  stopBtn.classList.add("hide");
}

function updateTime(sec = todaySeconds){
  const h = String(Math.floor(sec/3600)).padStart(2,"0");
  const m = String(Math.floor((sec%3600)/60)).padStart(2,"0");
  const s = String(sec%60).padStart(2,"0");
  timeEl.innerText = `${h}:${m}:${s}`;
}
</script>

</body>
</html>
